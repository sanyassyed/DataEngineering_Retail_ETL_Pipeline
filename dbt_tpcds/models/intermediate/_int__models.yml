version: 2

models:
  - name: int__date_bridge
    description: >
      Bridge table mapping TPCDS date surrogate keys to calendar dates.
      Used to link staging fact tables that use TPCDS date_sk values
      with the standardized dim_calendar table.
    columns:
      - name: d_date_sk
        description: "Surrogate key from the TPCDS date_dim table."
        tests:
          - not_null
          - unique
      - name: cal_dt
        description: "Calendar date value aligned with dim_calendar.calendar_dt."
        tests:
          - relationships:
              to: ref('dim_calendar')
              field: calendar_dt

  - name: int__dim_customer
    description: "Integrated dimension combining customer snapshot and related demographic attributes."
    columns:
      - name: customer_natural_key


  - name: int__fact_daily_sales
    description: "Aggregated daily sales combining catalog and web sales."
    columns:
      - name: date_sk
        description: "Surrogate key from dim_calendar, used for joins."
        tests:
          - relationships:
              to: ref('dim_calendar')
              field: date_sk
      - name: calendar_dt
        description: "Actual calendar date (DATE type) used for filtering and date operations."
      - name: warehouse_sk
        description: "Surrogate key for warehouse."
      - name: item_sk
        description: "Surrogate key for item."
      - name: daily_quantity
        description: "Total quantity sold per day."
      - name: daily_sales_amt
        description: "Total sales amount per day."
      - name: daily_net_profit
        description: "Total net profit per day."
      - name: year_number
        description: "Year associated with the calendar date."
      - name: week_of_year
        description: "Week number within the year."
      - name: update_time
        description: "Timestamp indicating when the record was last updated."

  - name: int__fact_weekly_sales_inventory
    description: >
      Integrated weekly-level fact table combining sales and inventory metrics.
      Aggregates daily sales and inventory data to weekly granularity,
      calculates weeks of supply, and flags potential low-stock conditions.
    columns:
      - name: warehouse_sk
        description: "Surrogate key of the warehouse."
        tests:
          - not_null
      - name: item_sk
        description: "Surrogate key of the item."
        tests:
          - not_null
      - name: date_sk
        description: "Week start date surrogate key (Sunday) from dim_calendar."
        tests:
          - relationships:
              to: ref('dim_calendar')
              field: date_sk
      - name: calendar_dt
        description: "Week start date (DATE type) for the given week."
      - name: year_number
        description: "Year number corresponding to the week."
      - name: week_of_year
        description: "Week number within the year."
      - name: sum_weekly_quantity
        description: "Total units sold during the week."
      - name: sum_weekly_sales_amt
        description: "Total sales amount generated during the week."
      - name: sum_weekly_net_profit
        description: "Total net profit earned during the week."
      - name: avg_qty_per_day
        description: "Average daily quantity sold across the week."
      - name: sum_weekly_inv_qty
        description: "Total on-hand inventory quantity for the week."
      - name: avg_daily_inv_qty
        description: "Average daily inventory quantity for the week."
      - name: wks_supply
        description: >
          Weeks of supply calculated as total inventory divided by total weekly quantity sold.
          NULL if no sales occurred during the week.
      - name: low_stock_flag_for_week
        description: >
          Boolean flag indicating low stock.
          TRUE if weeks of supply < 1, FALSE if sufficient inventory is available or no sales occurred.
